<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Chatbot (OpenRouter)</title>
<style>
  :root {
    --peach:#ffecd2;
    --orange:#fcb69f;
    --accent:#ff6f3c;
    --accent-2:#e85d2a;
    --bg:#fff;
    --ink:#342b25;
    --muted:#7a6f68;
  }
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    min-height:100svh; display:grid; place-items:center;
    background:linear-gradient(135deg,var(--peach),var(--orange));
  }
  .app{
    width:min(940px,95vw); height:min(88svh,820px);
    background:rgba(255,255,255,.9); backdrop-filter: blur(10px);
    border-radius:24px; box-shadow:0 18px 40px rgba(0,0,0,.12);
    display:grid; grid-template-rows:auto 1fr auto;
    overflow:hidden;
  }
  header{
    padding:16px 20px; background:linear-gradient(90deg,#ff9a76,#ff6f3c);
    color:#fff; display:flex; align-items:center; gap:12px; font-weight:700;
  }
  header .dot{width:10px; height:10px; border-radius:50%; background:#fff;}
  #log{
    padding:18px; overflow:auto; background:linear-gradient(180deg,#fff, #fffaf6);
  }
  .msg{max-width:78%; padding:12px 14px; border-radius:14px; margin:10px 0; line-height:1.45;}
  .bot{background:#fff; border:1px solid #f3e1d8; color:var(--ink); box-shadow:0 6px 14px rgba(0,0,0,.05);}
  .me{background:linear-gradient(90deg,#ff9a76,#ff6f3c); color:#fff; margin-left:auto;}
  .row{display:flex; align-items:center; gap:10px;}
  .tiny{font-size:12px; color:var(--muted); margin-top:4px;}
  .typing{display:inline-block; letter-spacing:2px; font-weight:700; color:var(--accent);}
  footer{
    padding:14px; display:flex; gap:10px; background:#fff7f1; border-top:1px solid #ffe2d3;
  }
  textarea{
    flex:1; resize:none; border:1px solid #f0d8cb; border-radius:14px;
    padding:12px 14px; font-size:15px; outline:none; min-height:52px; max-height:140px;
    box-shadow: inset 0 2px 6px rgba(0,0,0,.04); background:#fff;
  }
  button{
    border:none; border-radius:14px; padding:12px 18px; font-weight:700; cursor:pointer;
    background:linear-gradient(90deg,#ff6f3c,#e85d2a); color:#fff;
    box-shadow:0 8px 16px rgba(232,93,42,.25);
  }
  button:disabled{opacity:.6; cursor:not-allowed; box-shadow:none;}
  .hint{padding:0 18px 14px; color:#856a5b; font-size:12px;}
  .bar{height:4px; width:100%; background:#ffe1d3; position:relative; overflow:hidden; border-radius:999px; display:none}
  .bar::after{
    content:""; position:absolute; inset:0; width:35%; background:linear-gradient(90deg,#ff9a76,#ff6f3c);
    animation: load 1.1s linear infinite;
  }
  @keyframes load{0%{transform:translateX(-100%)}100%{transform:translateX(300%)}}
  .error{color:#b42318; background:#fff1ef; border:1px solid #ffd5ce}
</style>
</head>
<body>
  <main class="app">
    <header>
      <span class="dot"></span> Mindful Chatbot · OpenRouter (DeepSeek)
    </header>

    <section id="log" aria-live="polite">
      <div class="msg bot">
        Hi! I’m your friendly support bot. Share what’s on your mind, and I’ll respond with care.
        <div class="tiny">Tip: avoid sharing private info. This demo runs locally.</div>
      </div>
    </section>

    <div class="hint">
      Powered by <b>OpenRouter</b>. For production, move your API key to a backend.
    </div>
    <div class="bar" id="bar"></div>

    <footer>
      <textarea id="input" placeholder="Type a message... (Shift+Enter for new line)"></textarea>
      <button id="send">Send</button>
    </footer>
  </main>

<script>
/* ===========================
   ⚠️ DEMO ONLY — FRONTEND KEY
   For local testing only. Do NOT deploy with a visible key.
=========================== */
const OPENROUTER_KEY = "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"; // <- paste for local demo
const OPENROUTER_MODEL = "deepseek/deepseek-chat-v3.1:free";

const logEl   = document.getElementById("log");
const inputEl = document.getElementById("input");
const sendBtn = document.getElementById("send");
const barEl   = document.getElementById("bar");

// helpers
const el = (html) => {
  const t = document.createElement("template");
  t.innerHTML = html.trim();
  return t.content.firstChild;
};
const addMsg = (content, who="bot", isError=false) => {
  const cls = `msg ${who}` + (isError ? " error" : "");
  const node = el(`<div class="${cls}"></div>`);
  node.textContent = content;
  logEl.appendChild(node);
  logEl.scrollTop = logEl.scrollHeight;
  return node;
};
const setLoading = (on) => {
  sendBtn.disabled = on;
  barEl.style.display = on ? "block" : "none";
};

async function send() {
  const text = inputEl.value.trim();
  if (!text) return;

  addMsg(text, "me");
  inputEl.value = "";
  setLoading(true);

  try {
    const resp = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${OPENROUTER_KEY}`,
        "HTTP-Referer": window.location.origin || "http://localhost", // for OpenRouter rankings
        "X-Title": "Hackathon-Chatbot",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: OPENROUTER_MODEL,
        messages: [
          { role: "system", content: "You are a warm, supportive mental-wellbeing assistant. Be kind, concise, and practical. Avoid medical claims." },
          { role: "user", content: text }
        ]
      })
    });

    if (!resp.ok) {
      const text = await resp.text();
      addMsg(`API error: ${resp.status} ${resp.statusText}\n${text}`, "bot", true);
      setLoading(false);
      return;
    }

    const data = await resp.json();
    const reply = data?.choices?.[0]?.message?.content || "(No reply)";
    addMsg(reply, "bot");
  } catch (e) {
    addMsg("Network error: " + (e?.message || e), "bot", true);
  } finally {
    setLoading(false);
  }
}

sendBtn.addEventListener("click", send);
inputEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});
</script>
</body>
</html>
