<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Stress Catcher</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
<style>
body {
  margin:0; height:100vh; display:grid; place-items:center;
  background:linear-gradient(135deg,#e0f2fe,#e9d5ff);
  font-family:Poppins,system-ui;
  transition:background 2s linear;
}
.card {
  width:min(520px,95vw); padding:18px;
  background:rgba(255,255,255,.9); backdrop-filter:blur(10px);
  border-radius:18px; box-shadow:0 12px 28px rgba(0,0,0,.12);
  text-align:center;
}
h1 { margin:.2rem 0 10px; color:#334155; }
canvas {
  display:block; margin:auto; background:#f8fafc;
  border-radius:14px; box-shadow:inset 0 6px 16px rgba(0,0,0,.1);
}
.mood { margin-top:10px; font-weight:700; color:#334155; }
.bar { height:12px; background:#e5e7eb; border-radius:6px; overflow:hidden; margin-top:6px; }
.fill { height:100%; width:70%; transition:width .25s, background .5s; }
button { border:0; border-radius:10px; padding:8px 14px; margin:6px; font-weight:700; color:#fff; background:#2563eb; cursor:pointer; }
.pad { display:none; }
@media (max-width:560px){
  .pad { display:flex; gap:12px; justify-content:center; margin-top:8px; }
  .pad button { background:#64748b; }
}
</style>
</head>
<body>
<div class="card" id="gameBox">
  <h1>⚡ Stress Catcher</h1>
  <canvas id="cv" width="480" height="360"></canvas>
  <div>
    <button id="start">Start</button>
    <button id="reset">Reset</button>
  </div>
  <div class="pad"><button id="left">◀</button><button id="right">▶</button></div>
  <div class="mood" id="txt">Score 0 • Mood: Calm 🙂</div>
  <div class="bar"><div class="fill" id="fill"></div></div>
  <a href="games.html" style="display:inline-block;margin-top:12px;color:#2563eb;font-weight:700;">⬅ Back</a>
</div>

<script>
const cv=document.getElementById("cv"), ctx=cv.getContext("2d");
const txt=document.getElementById("txt"), fill=document.getElementById("fill");
const gameBox=document.getElementById("gameBox");

const calmEmojis=["😊","🌸","🕊️","🌞","✨"];
const stressEmojis=["⚡","💢","😠","🔥","😰"];

const player={x:cv.width/2,y:cv.height-30,w:90,h:20,spd:6};
let items=[], doodles=[], running=false, score=0, mood=70;
let lastTime=0, spawnTimer=0, doodleTimer=0, animId=null, hue=200;

// doodle sets
const doodleSets={
  calm:["🌸","✨","🔵"],
  neutral:["🌿","🍂","🌼"],
  stressed:["⚡","💢","☁️"]
};

// spawn emojis
function spawn(){
  const good=Math.random()>0.35;
  const emoji = good ? calmEmojis[Math.floor(Math.random()*calmEmojis.length)]
                     : stressEmojis[Math.floor(Math.random()*stressEmojis.length)];
  items.push({x:30+Math.random()*(cv.width-60),y:-20,v:1.5+Math.random()*2,good,emoji,angle:Math.random()*Math.PI});
}

// spawn doodles
function spawnDoodle(){
  if(doodles.length>20) return; // cap
  let set="neutral";
  if(mood>70) set="calm"; else if(mood<35) set="stressed";
  const emoji=doodleSets[set][Math.floor(Math.random()*doodleSets[set].length)];
  doodles.push({
    x:Math.random()*cv.width,
    y:cv.height+20,
    v:0.2+Math.random()*0.6,
    a:1,
    emoji,
    angle:Math.random()*Math.PI
  });
}

function drawPlayer(){
  ctx.fillStyle="#3b82f6";
  ctx.fillRect(player.x-player.w/2,player.y,player.w,player.h);
  ctx.fillStyle="#1e40af";
  ctx.fillRect(player.x-player.w/2,player.y+player.h-5,player.w,5);
}

function drawItem(it){
  ctx.save();
  ctx.translate(it.x,it.y);
  ctx.rotate(Math.sin(it.y/50+it.angle)*0.2);
  ctx.font="30px Poppins"; ctx.textAlign="center"; ctx.strokeStyle="#fff"; ctx.lineWidth=3;
  ctx.strokeText(it.emoji,0,0); ctx.fillText(it.emoji,0,0);
  ctx.restore();
}

function drawDoodle(d){
  ctx.save();
  ctx.translate(d.x,d.y);
  ctx.rotate(Math.sin(d.y/40+d.angle)*0.2);
  ctx.font="22px Poppins"; ctx.textAlign="center"; ctx.globalAlpha=d.a;
  ctx.fillText(d.emoji,0,0);
  ctx.restore();
}

function label(){
  const state=mood>70?"Calm 🙂":(mood<35?"Stressed 😟":"Neutral 😐");
  txt.textContent=`Score ${score} • Mood: ${state}`;
  if(mood>70) fill.style.background="linear-gradient(90deg,#22c55e,#a7f3d0)";
  else if(mood<35) fill.style.background="linear-gradient(90deg,#ef4444,#fca5a5)";
  else fill.style.background="linear-gradient(90deg,#facc15,#fde047)";
  fill.style.width=mood+"%";
}

function glowEffect(){
  gameBox.style.boxShadow="0 0 25px #22c55e";
  setTimeout(()=>gameBox.style.boxShadow="0 12px 28px rgba(0,0,0,.12)",200);
}
function shakeEffect(){
  gameBox.style.transform="translateX(-6px)";
  setTimeout(()=>gameBox.style.transform="translateX(6px)",100);
  setTimeout(()=>gameBox.style.transform="",200);
}

function loop(timestamp){
  if(!running) return;
  const dt=(timestamp-lastTime)/16; lastTime=timestamp;
  spawnTimer+=dt; doodleTimer+=dt;

  if(spawnTimer>55){ spawn(); spawnTimer=0; }
  if(doodleTimer>50){ spawnDoodle(); doodleTimer=0; }

  hue=(hue+0.1)%360;
  document.body.style.background=`linear-gradient(135deg,hsl(${hue},90%,96%),hsl(${(hue+80)%360},90%,96%))`;

  ctx.clearRect(0,0,cv.width,cv.height);

  // doodles
  for(let i=doodles.length-1;i>=0;i--){
    const d=doodles[i]; d.y-=d.v*dt; d.a=Math.max(0,d.a-0.0005*dt);
    drawDoodle(d);
    if(d.y<-20||d.a<=0) doodles.splice(i,1);
  }

  // items
  for(let i=items.length-1;i>=0;i--){
    const it=items[i]; it.y+=it.v*dt; drawItem(it);
    if(it.y>player.y-5 && Math.abs(it.x-player.x)<player.w/2){
      items.splice(i,1);
      if(it.good){score+=5; mood=Math.min(100,mood+5); glowEffect();}
      else {score=Math.max(0,score-3); mood=Math.max(0,mood-10); shakeEffect();}
    } else if(it.y>cv.height+20){ items.splice(i,1); }
  }

  drawPlayer(); label();
  animId=requestAnimationFrame(loop);
}

// controls
document.getElementById("start").onclick=()=>{
  if(!running){ running=true; score=0; mood=70; items=[]; doodles=[]; lastTime=performance.now(); loop(lastTime); }
};
document.getElementById("reset").onclick=()=>{
  running=false; cancelAnimationFrame(animId);
  items=[]; doodles=[]; score=0; mood=70; ctx.clearRect(0,0,cv.width,cv.height); label();
};

document.getElementById("left").onclick=()=>player.x=Math.max(player.w/2,player.x-40);
document.getElementById("right").onclick=()=>player.x=Math.min(cv.width-player.w/2,player.x+40);

addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") player.x=Math.max(player.w/2,player.x-player.spd);
  if(e.key==="ArrowRight") player.x=Math.min(cv.width-player.w/2,player.x+player.spd);
});

cv.addEventListener("pointermove",e=>{
  const r=cv.getBoundingClientRect();
  player.x=Math.min(cv.width-player.w/2,Math.max(player.w/2,(e.clientX-r.left)*cv.width/r.width));
});

label();
</script>
</body>
</html>
